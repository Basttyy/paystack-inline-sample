<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" />
<script>
// load jQuery 1.12.3 if not loaded
!window.jQuery && document.write("<scr" + "ipt type="text/javascript" src="https://code.jquery.com/jquery-1.12.3.min.js"></scr" + "ipt>");
</script>
<form id="payment-form" class="trans col-sm-5 cnter-block animated fadeInUp">
  <div class="form-group payment-form amount">
    <label for="">Amount (Naira)</label>
    <input id="payment-amount" type="text" class="form-control" placeholder="How much do you want to pay" autocomplete="off">
    <span class="help-block hidden">* Minimum  amount is N100</span>
  </div>
  <div class="form-group payment-form email">
    <label for="">Email Address</label>
    <input id="payment-email" type="email" class="form-control" placeholder="Your email address" autocomplete="off">
    <span class="help-block hidden">* Please use a valid email address</span>
  </div>
  <div class="form-group text-right call-to-action">
    <button id="payment-btn" class="btn btn-block green-btn large-btn trans" style="margin: 0">Make Payment</button>
  </div>
  <script src="https://js.paystack.co/v1/inline.js"></script>
</form>
<div id="success-message" class="row animated fadeInUp hidden col-md-12">
  <div class="call-to-action text-center mb">
    <span class="fa fa-check pay-thanks"></span>
    <h3>Successful!</h3>
    <div class="col-md-8 col-md-offset-2">
      <p class="demo-success">Your transaction reference is <b id="trans-ref"></b>. You will also get a confirmation message in the mail.</p>
    </div>
    <div class="col-md-4 col-md-offset-4 mb">
      <a id="pay-again" class="btn btn-block large-btn trans" style="margin-left: 0">Make another payment</a>
    </div>
  </div>
</div>
<script>
    $(function () {
      var invalid_email;
      var paystackHandler;

      function validateEmail(email) {
        var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
        return re.test(email);
      }

      $('#payment-amount').autoNumeric('init');

      var typingTimer;
      $('#payment-email').on('keyup', function () {
        clearTimeout(typingTimer);
        var email = $(this).val();
        var parent = $(this).parent();
        var email_helper = $(this).siblings('.help-block');
        typingTimer = setTimeout(function () {
          if (validateEmail(email)) {
            if (invalid_email) {
              parent.removeClass('has-error');
              email_helper.addClass('hidden');
              invalid_email = false;
            }
          } else {
            if (!invalid_email) {
              parent.addClass('has-error');
              email_helper.removeClass('hidden')
              invalid_email = true;
            }
          }
        }, 500);
      });

      $('#payment-amount').on('change', function () {
        var amount = $(this).val();
        var parent = $(this).parent();
        var amount_helper = $(this).siblings('.help-block');
        if (amount < 100.00) {
          parent.addClass('has-error');
          amount_helper.removeClass('hidden');
        } else {
          parent.removeClass('has-error');
          amount_helper.addClass('hidden');
        }
      });

      $('#payment-btn').click(function (e) {
        e.preventDefault();

        var payment_btn = $(this);
        var no_payment_email = $('#payment-email').val().length == 0;
        var payment_value = $('#payment-amount').autoNumeric('get');

        if (no_payment_email || invalid_email) {

          $('.payment-form.email').addClass('has-error');
          $('.email .help-block').removeClass('hidden');
          return;
        }

        if (payment_value < 100) {

          $('.payment-form.amount').addClass('has-error');
          $('.amount .help-block').removeClass('hidden');
          return;
        }

        paystackHandler = PaystackPop.setup({
          key: 'pk_live_3223432j3328nmdsad233tIshFeQd4XMUh',
          email: $('#payment-email').val(),
          amount: parseFloat(payment_value) * 100,
          onClose: function () {
            payment_btn.attr('disabled', false).html('Make Payment');
          },
          callback: function (response) {
            $("#payment-form, .demo-talk").addClass('hidden');
            $("#success-message").removeClass('hidden').find('#trans-ref').text(response.trxref);
          }
        })
        paystackHandler.openIframe();
        payment_btn.attr('disabled', true).html('<i class="fa fa-spinner fa-spin"></i>');
      })

      $("#pay-again").click(function () {
        $("#payment-form, .demo-talk").removeClass('hidden').find("#payment-amount").val("").focus();
        $("#success-message").addClass('hidden').find('#trans-ref').text("");
        $('#payment-btn').attr('disabled', false).html('Make another Payment');
      })
    })
</script>
